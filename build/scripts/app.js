var Application=function(){function a(a){var b,c,d=(a||"Application").split("."),e=window.Application||(window.Application={});for(d="Application"===d[0]?d.slice(1):d,b=0,c=d.length;c>b;b++)e[d[b]]=e[d[b]]||{},e=e[d[b]];return e}function b(){f=new d.DateRange,e.NavigationController.bind(f),e.NoteController.bind(f)}function c(){window.addEventListener("load",function(){b()})}var d={},e={},f=null;return{Models:d,Controllers:e,getNamespace:a,start:c}}();!function(a){var b=a.getNamespace("Models");b.DateContainer=function(a,b){this.date=a,this.notes=b},b.DateContainer.prototype.save=function(){b.Storage.Notes.save(this.date,this.notes)},b.DateContainer.prototype.createNote=function(){var a=new b.Note,c=Math.max(a.id,this.notes.length&&this.notes.reduce(function(a,b){return a=a&&a.id||0,b=b&&b.id||0,Math.max(a,b)})||0);return a.id=a.id<c?c+1:a.id,this.notes.push(a),this.save(),a},b.DateContainer.prototype.getNoteById=function(a){var b=0,c=this.notes.length;for(b=0;c>b;b++)if(this.notes[b].id===a)return this.notes[b];return null}}(Application),function(a){var b=a.getNamespace("Models");b.DateRange=function(){this._currentDate=null,this._currentWeek=null,this._subscribes=[],this._initialize()},b.DateRange.MILISEC=864e5,b.DateRange.DAYS_QUANTITY=7,b.DateRange.prototype._initialize=function(){var a,c,d=new Date,e=d.getDay(),f=d.getTime()-(e-1)*b.DateRange.MILISEC,g=d.getTime()+(b.DateRange.DAYS_QUANTITY-e)*b.DateRange.MILISEC;for(0===e&&(f=d.getTime()-(b.DateRange.DAYS_QUANTITY-1)*b.DateRange.MILISEC,g=d),c=f,this._currentWeek=[];g>=c;c+=b.DateRange.MILISEC)a=new b.DateContainer(new Date(c),b.Storage.Notes.get(new Date(c))),this._currentWeek.push(a),c===d.getTime()&&(this._currentDate=a)},b.DateRange.prototype._callSubscribers=function(){var a,b=this._subscribes.length;for(a=0;b>a;a++)this._subscribes[a](this._currentDate)},b.DateRange.prototype.createNote=function(){return this._currentDate.createNote()},b.DateRange.prototype.getNextWeek=function(){var a,c=this._currentWeek[this._currentWeek.length-1].date.getTime()+b.DateRange.MILISEC,d=c+(b.DateRange.DAYS_QUANTITY-1)*b.DateRange.MILISEC;for(this._currentWeek=[],a=c;d>=a;a+=b.DateRange.MILISEC)this._currentWeek.push(new b.DateContainer(new Date(a),b.Storage.Notes.get(new Date(a))));return this.changeCurrentDay(0),this._currentWeek},b.DateRange.prototype.getPreviousWeek=function(){var a,c=this._currentWeek[0].date.getTime()-b.DateRange.DAYS_QUANTITY*b.DateRange.MILISEC,d=c+b.DateRange.MILISEC*(b.DateRange.DAYS_QUANTITY-1);for(this._currentWeek=[],a=c;d>=a;a+=b.DateRange.MILISEC)this._currentWeek.push(new b.DateContainer(new Date(a),b.Storage.Notes.get(new Date(a))));return this.changeCurrentDay(6),this._currentWeek},b.DateRange.prototype.getCurrentWeek=function(){return this._currentWeek},b.DateRange.prototype.getCurrentDay=function(){return this._currentDate},b.DateRange.prototype.changeCurrentDay=function(a){if("number"!=typeof a)throw new TypeError("Models.DateRange.changeCurrentDay illegal argument error!");if(0>a||a>6)throw new RangeError("Date is out of the range!");return this._currentDate=this._currentWeek[a],this._callSubscribers(),this._currentDate},b.DateRange.prototype.subscribe=function(a){if("function"!=typeof a)throw new TypeError("Illegal argument!");this._subscribes.push(a)}}(Application),function(a){var b=a.getNamespace("Models");b.DayNames=["Monday","Tuesday","Thursday","Wednesday","Friday","Saturday","Sunday"]}(Application),function(a){var b=a.getNamespace("Models");b.DaysEnum={MONDAY:0,TUESDAY:1,WEDNESDAY:2,THURSDAY:3,FRIDAY:4,SATURDAY:5,SUNDAY:6}}(Application),function(a){var b=a.getNamespace("Models");b.Months=["January","February","March","April","May","June","July","August","September","October","November","December"]}(Application),function(a){var b=a.getNamespace("Models");b.Note=function(a){this.id=b.Note.id++,this.date=a,this.title="Title",this.description="Description",this.position={x:0,y:0}},b.Note.id=0}(Application),function(a){var b=a.getNamespace("Models"),c=a.getNamespace("Utils");b.Storage={Notes:{get:function(a){var b=null;if(!(a instanceof Date))throw new TypeError("Illegal arguments!");return a=c.resetTime(a),b=localStorage&&localStorage[a.getTime()],b?JSON.parse(b):[]},save:function(a,b){if(!a instanceof Date)throw new TypeError("Illegal arguments!");a=c.resetTime(a),localStorage[a.getTime()]=JSON.stringify(b)},saveOne:function(a,c){var d,e,f;if(!c instanceof b.Note)throw new TypeError("Illegal argument");for(d=this.get(a),e=0,f=d.length;f>e;e++)if(d[e].id===c.id){d[e]=c;break}this.save(a,d)},"delete":function(a,b){var c,d,e;for(e=this.get(a),c=0,d=e.length;d>c&&e[c].id!==b;c++);e.splice(c,1),this.save(a,e)},deleteAll:function(a){if(!(a instanceof Date))throw new TypeError("Illegal arguments!");a=c.resetTime(a),localStorage.removeItem(a.getTime())}}}}(Application),function(a){var b=a.getNamespace("Utils");b.resetTime=function(a){if(!(a instanceof Date))throw new TypeError("Illegal argument!");return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a}}(Application),function(a){var b=a.getNamespace("Controllers"),c=a.getNamespace("Models"),d=a.getNamespace("Views");b.NavigationController={bind:function(a){var b=document.querySelector(".container"),e=document.querySelector(".wrapper header"),f=new d.CanvasView,g=new d.NavigationView,h=new d.MonthView,i=new d.DateView,j=a.getCurrentDay().date.getDate();h.month=c.Months[a.getCurrentDay().date.getMonth()],h.parent=e,h.render(!1),i.date=10>j?"0"+j:j,i.parent=b,i.render(),f.parent=b,f.data=a.getCurrentDay(),f.render(),g.parent=e,g.data=a,g.render(),a.subscribe(function(a){f.data=a,f.refresh()}),a.subscribe(function(a){h.month=c.Months[a.date.getMonth()],h.refresh()}),a.subscribe(function(a){i.date=a.date.getDate(),i.refresh()})}}}(Application),function(a){var b=a.getNamespace("Controllers"),c=(a.getNamespace("Models"),a.getNamespace("Views"));b.NoteController={bind:function(a){var b=document.getElementById("createNote");b.addEventListener("click",function(){var b=new c.NoteView(a.getCurrentDay().date,a.createNote()),d=document.querySelector('[id^="canvas-"]');b.parentEle=d,b.render()})}}}(Application),function(a){var b=a.getNamespace("Views"),c=a.getNamespace("Models");b.CanvasView=function(){this.id="canvas-"+ ++b.CanvasView.count,this.parent=null,this._element=null,this.data=null},b.CanvasView.prototype._buildElement=function(){var a,c,d;if(this._element=this._element||document.createElement("div"),this._element.id=this.id,this.data&&this.data.notes)for(c=0,d=this.data.notes.length;d>c;c++)a=new b.NoteView(this.data.date,this.data.notes[c]),this._element.appendChild(a.getElement())},b.CanvasView.prototype._bind=function(){function a(a,c){var d,e=b.data,f=e.notes,g=+c.getAttribute("number"),h=f.length;for(d=0;h>d&&f[d].id!==g;d++);f.splice(1,d),e.save(),a.removeChild(c)}var b=this;this._element&&(this._element.addEventListener("click",function(b){b.target.classList.contains("delete")&&a(b.currentTarget,b.target.parentElement.parentElement)}),this._element.addEventListener("mousedown",function(a){function d(a){var b=a.clientX,c=a.clientY,d=c-g.offsetTop-j,e=b-g.offsetLeft-i,h=e+f.clientWidth;d>0&&(f.style.top=c-j+"px"),g.clientWidth>h&&h>f.clientWidth&&(f.style.left=b-i+"px")}function e(a){var k,l,m=0;for(h.position.y=a.clientY-j,h.position.x=a.clientX-i,k=0,l=b.data.notes.length;l>k;k++)b.data.notes[k].id!==h.id&&Math.abs(b.data.notes[k].position.x-h.position.x)<f.clientWidth&&Math.abs(b.data.notes[k].position.y-h.position.y)<f.clientHeight&&(m=b.data.notes[k].index>=m?b.data.notes[k].index+1:m);h.index=m,c.Storage.Notes.saveOne(b.data.date,h),a.target.style.cursor="text",f.style.zIndex=m,g.removeEventListener("mouseup",e),g.removeEventListener("mousemove",d)}var f,g,h,i,j;a.target.classList.contains("title")&&(f=a.target.parentElement.parentElement,h=b.data.getNoteById(+f.getAttribute("number")),g=a.currentTarget.parentElement,i=a.clientX-f.offsetLeft,j=a.clientY-f.offsetTop,a.target.style.cursor="move",f.style.zIndex=1e3,g.addEventListener("mousemove",d),g.addEventListener("mouseup",e))}),this._element.addEventListener("dragstart",function(a){a.preventDefault()}),this._element.addEventListener("change",function(a){var d=null,e=null;b.data&&(d=b.data,e=d.getNoteById(+a.target.parentElement.getAttribute("number")),a.target.classList.contains("title")?e.title=a.target.value:a.target.classList.contains("description")&&(e.description=a.target.value),c.Storage.Notes.saveOne(d.date,e))}))},b.CanvasView.prototype.render=function(){if(!this.parent)throw new ReferenceError("A parent element is empty!");this._buildElement(),this._bind(),this.parent.appendChild(this._element)},b.CanvasView.prototype.clear=function(){for(;this._element&&this._element.firstChild;)this._element.removeChild(this._element.firstChild)},b.CanvasView.prototype.refresh=function(){this.clear(),this._buildElement()},b.CanvasView.count=0}(Application),function(a){var b=a.getNamespace("Views");b.DateView=function(){this.id="date-container-"+ ++b.DateView.count,this.date=null,this.parent=null,this._element=null},b.DateView.count=0,b.DateView.prototype._buildElement=function(){this._element=document.createElement("div"),this._element.className="dateText",this._element.appendChild(document.createElement("span")),this._element.firstChild.id="date",this.date&&this._element.firstChild.appendChild(document.createTextNode(this.date))},b.DateView.prototype.refresh=function(){this._element.firstChild.innerText=this.date?this.date:""},b.DateView.prototype.render=function(){if(!this.parent)throw new ReferenceError("A parent element is empty!");this._buildElement(),this.parent.appendChild(this._element)}}(Application),function(a){var b=a.getNamespace("Views");b.MonthView=function(){this.id="month-view-"+ ++b.MonthView.count,this.month="",this._element=null,this.parent=null},b.MonthView.count=0,b.MonthView.prototype._buildElement=function(){this._element=document.createElement("span"),this._element.id=this.id,this._element.className="monthText",this.month&&(this._element.textContent=this.month)},b.MonthView.prototype.render=function(a){if(!this.parent)throw new ReferenceError("A parent element is empty!");this._buildElement(),a!==!1?this.parent.appendChild(this._element):this.parent.insertBefore(this._element,this.parent.firstChild)},b.MonthView.prototype.refresh=function(){this.month&&(this._element.textContent=this.month)}}(Application),function(a){{var b=a.getNamespace("Views");a.getNamespace("Models")}b.NavigationView=function(){this.id="navigation-view-"+ ++b.NavigationView.count,this._element=null,this.data=null,this.parent=null},b.NavigationView.prototype._rebuildElement=function(){var a,b,c=null,d=7,e=['<label class="roundStyle noPin" id="{0}">',"<p>{1}</p>","<span></span>","<p>{2}</p>","</label>"].join("\n"),f=['<input type="radio" name="daysNdates" id="{0}"/>','<label for={0} class="roundStyle" id="{1}">','<p class="day">{2}</p>',"<span></span>","<p>{0}</p>","</label>"].join("\n"),g=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];for(c=this.data.getCurrentWeek(),this._element.innerHTML="",child=document.createElement("section"),child.innerHTML=e.replace(/\{0\}/g,"previous").replace(/\{1\}/g,"◄").replace(/\{2\}/g,"prev"),this._element.appendChild(child),a=0;d>a;a++)child=document.createElement("section"),child.innerHTML=f.replace(/\{0\}/g,g[a]).replace(/\{1\}/g,a).replace(/\{2\}/g,this.data.getCurrentWeek()[a].date.getDate()),a===this.data.getCurrentWeek().indexOf(this.data.getCurrentDay())&&(b=child.querySelector('input[type="radio"]'),b.checked=!0),this._element.appendChild(child);child=document.createElement("section"),child.innerHTML=e.replace(/\{(0|2)\}/g,"next").replace(/\{1\}/g,"►"),this._element.appendChild(child)},b.NavigationView.prototype._buildElement=function(){if(this._element=document.createElement("nav"),this._element.id=this.id,!this.data)throw new ReferenceError(" The data property of instance can't be null ");this._rebuildElement()},b.NavigationView.prototype._bind=function(){{var a=this;document.getElementById("month"),document.getElementById("date"),document.querySelector('[id^="canvas-"]')}this._element.addEventListener("click",function(b){var c,d=!0;((d=b.target.classList.contains("roundStyle"))||b.target.parentElement.classList.contains("roundStyle"))&&(c=d?b.target:b.target.parentElement,"previous"===c.id?(a.data.getPreviousWeek(),a._rebuildElement()):"next"===c.id?(a.data.getNextWeek(),a._rebuildElement()):"createNote"!==c.id&&a.data.changeCurrentDay(+c.id))})},b.NavigationView.prototype.render=function(){if(!this.parent)throw new ReferenceError("A parent element is empty!");this._buildElement(),this._bind(),this.parent.appendChild(this._element)},b.NavigationView.count=0}(Application),function(a){var b=(a.getNamespace("Models"),a.getNamespace("Utils"),a.getNamespace("Views"));b.NoteView=function(a,b){this._date=a,this._data=b,this._element=null,this.parentEle=null},b.NoteView.prototype._buildElement=function(){var a=document.createElement("div"),b=document.createElement("section"),c=document.createElement("section"),d=document.createElement("input"),e=document.createElement("textarea"),f=document.createElement("input");a.className="noteWrapper",a.setAttribute("number",this._data.id),a.setAttribute("draggable","true"),a.id="note-"+this._data.id,a.style.left=(this._data.position.x||350)+"px",a.style.top=(this._data.position.y||150)+"px",a.style.zIndex=this._data.index,a.appendChild(c),a.appendChild(b),c.appendChild(d),c.appendChild(f),b.appendChild(e),f.setAttribute("type","button"),d.className="textControl title",d.setAttribute("value",this._data.title),e.className="textControl description",e.textContent=this._data.description,e.style.resize="none",e.setAttribute("spellcheck","false"),f.className="btn delete",f.setAttribute("value","×"),this._element=a},b.NoteView.prototype.getElement=function(){return this._buildElement(),this._element},b.NoteView.prototype.render=function(){if(!this.parentEle)throw new ReferenceError("A parent element is empty!");this._buildElement(),this.parentEle.appendChild(this._element)}}(Application);